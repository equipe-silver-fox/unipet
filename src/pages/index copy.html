<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <meta name="theme-color" content="#8B5CF6" />
    <title>Unipet</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link rel="stylesheet" href="../../public/style.css" />
  </head>
  <body>
    <!-- Header -->
    <div class="header">
      <div class="logo">
        <img src="../../public/img/logo.png" />
        <span>Unipet</span>
      </div>
    </div>

    <!-- Menu de Acessibilidade -->
    <button
      id="btnAcessibilidade"
      class="btn-acessibilidade"
      aria-label="Abrir menu de acessibilidade"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="16"
        height="16"
        fill="currentColor"
        class="bi bi-universal-access-circle"
        viewBox="0 0 16 16"
      >
        <path
          d="M8 4.143A1.071 1.071 0 1 0 8 2a1.071 1.071 0 0 0 0 2.143m-4.668 1.47 3.24.316v2.5l-.323 4.585A.383.383 0 0 0 7 13.14l.826-4.017c.045-.18.301-.18.346 0L9 13.139a.383.383 0 0 0 .752-.125L9.43 8.43v-2.5l3.239-.316a.38.38 0 0 0-.047-.756H3.379a.38.38 0 0 0-.047.756Z"
        />
        <path
          d="M8 0a8 8 0 1 0 0 16A8 8 0 0 0 8 0M1 8a7 7 0 1 1 14 0A7 7 0 0 1 1 8"
        />
      </svg>
    </button>

    <div id="menuAcessibilidade" class="menu-acessibilidade hidden">
      <h3>Acessibilidade</h3>
      <button id="aumentarFonte">Aumentar Fonte</button>
      <button id="diminuirFonte">Diminuir Fonte</button>
      <button id="altoContraste">Alto Contraste</button>
      <button id="resetarAcessibilidade">Resetar</button>
    </div>

    <!-- Content -->
    <div class="content">
      <!-- Home Page -->
      <div id="page-home" class="page">
        <div class="welcome">
          <div class="welcome-icon">üêæ</div>
          <h1>Bem-vindo ao Unipet!</h1>
          <p>
            A <strong>Unipet</strong> conecta animais que precisam de um lar a
            pessoas interessadas em adotar, tornando o processo mais √°gil e
            transparente.
          </p>
        </div>
      </div>

      <!-- Pets Page -->
      <div id="page-pets" class="page hidden"></div>

      <!-- Profile Page -->
      <div id="page-profile" class="page hidden">
        <div class="profile-header">
          <div class="profile-avatar">
            <i class="fa-solid fa-user"></i>
          </div>
          <div class="profile-name"></div>
          <div class="profile-email"></div>
        </div>

        <div class="profile-menu">
          <div class="menu-item">
            <div class="menu-icon">
              <i class="fa-solid fa-user-pen"></i>
            </div>
            <div class="menu-text">Editar Perfil</div>
            <div class="menu-arrow">
              <i class="fa-solid fa-chevron-right"></i>
            </div>
          </div>

          <div class="menu-item" data-action="sair">
            <div class="menu-icon">
              <i class="fa-solid fa-right-from-bracket"></i>
            </div>
            <div class="menu-text">Sair</div>
            <div class="menu-arrow">
              <i class="fa-solid fa-chevron-right"></i>
            </div>
          </div>
        </div>
        <button id="btnAddPetProfile" class="btn-add-pet-profile">
          <i class="fa-solid fa-plus"></i> Adicionar Pet
        </button>
        <div id="modalAddPetProfile" class="modal hidden">
          <div class="modal-content">
            <h3>Adicionar Novo Pet</h3>
            <form id="formAddPetProfile">
              <input type="url" placeholder="URL da Imagem" required />
              <input type="text" placeholder="Descri√ß√£o" required />
              <input
                type="text"
                placeholder="Tags (separadas por v√≠rgula)"
                required
              />
              <input type="text" placeholder="Contato" required />
              <div class="modal-buttons">
                <button type="submit">Adicionar</button>
                <button type="button" id="btnCancelPetProfile">Cancelar</button>
              </div>
            </form>
          </div>
        </div>
      </div>

      <!-- Modal/Form para adicionar pet -->
    </div>

    <!-- Footer Navigation -->
    <nav class="footer-nav">
      <a class="nav-item active" data-page="home">
        <i class="fa-solid fa-house nav-icon"></i>
        <span class="nav-label">In√≠cio</span>
      </a>
      <a class="nav-item" data-page="pets">
        <i class="fa-solid fa-paw nav-icon"></i>
        <span class="nav-label">Pets</span>
      </a>
      <a class="nav-item" data-page="profile">
        <i class="fa-solid fa-user nav-icon"></i>
        <span class="nav-label">Perfil</span>
      </a>
    </nav>

    <script src="../../public/script.js"></script>
    <script>
      const API_URL = "http://localhost:3000";
      const usuario = JSON.parse(localStorage.getItem("usuarioLogado"));

      if (!usuario) {
        window.location.href = "loguin.html";
      } else {
        document.querySelector(".profile-name").textContent = usuario.nome;
        document.querySelector(".profile-email").textContent = usuario.email;
      }

      // Menu inferior
      const navItems = document.querySelectorAll(".nav-item");
      const pages = document.querySelectorAll(".page");
      navItems.forEach((item) => {
        item.addEventListener("click", function () {
          navItems.forEach((nav) => nav.classList.remove("active"));
          this.classList.add("active");
          pages.forEach((p) => p.classList.add("hidden"));
          const pageName = this.getAttribute("data-page");
          document
            .getElementById(`page-${pageName}`)
            .classList.remove("hidden");
        });
      });

      // Perfil
      const [editarPerfilBtn, sairBtn] = document.querySelectorAll(
        ".profile-menu .menu-item"
      );

      editarPerfilBtn.addEventListener("click", async () => {
        const novoNome = prompt("Digite seu novo nome:", usuario.nome);
        const novoEmail = prompt("Digite seu novo email:", usuario.email);
        if (!novoNome || !novoEmail) return alert("Nome e email obrigat√≥rios!");
        usuario.nome = novoNome;
        usuario.email = novoEmail;
        localStorage.setItem("usuarioLogado", JSON.stringify(usuario));
        document.querySelector(".profile-name").textContent = novoNome;
        document.querySelector(".profile-email").textContent = novoEmail;

        try {
          const res = await fetch(`${API_URL}/usuarios/${usuario.id}`, {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(usuario),
          });
          if (!res.ok) throw new Error();
          alert("Perfil atualizado com sucesso!");
        } catch {
          alert("N√£o foi poss√≠vel atualizar o perfil no servidor.");
        }
      });

      sairBtn.addEventListener("click", () => {
        localStorage.removeItem("usuarioLogado");
        window.location.href = "loguin.html";
      });

      // Pets
      async function carregarPets() {
        const res = await fetch(`${API_URL}/pets`);
        const pets = await res.json();
        const container = document.getElementById("page-pets");
        container.innerHTML = `<h2 class="section-title"><i class="fa-solid fa-dog"></i> Nossos Pets</h2>`;
        pets.forEach((p) => {
          const card = document.createElement("div");
          card.className = "pet-card";
          card.innerHTML = `
            <div class="pet-avatar"><img src="${p.imagem}" /></div>
            <div class="pet-info">
              <div class="pet-name">${p.nome}</div>
              <div class="pet-details"><span>${p.tipo}</span> ‚Ä¢ <span>${
            p.idade || "?"
          } anos</span></div>
            </div>`;
          container.appendChild(card);
        });
      }
      carregarPets();
    </script>
    <script>
      // Seletores
      const btnAddPetProfile = document.getElementById("btnAddPetProfile");
      const modalAddPetProfile = document.getElementById("modalAddPetProfile");
      const btnCancelPetProfile = document.getElementById(
        "btnCancelPetProfile"
      );
      const formAddPetProfile = document.getElementById("formAddPetProfile");

      // Mostrar modal
      btnAddPetProfile.addEventListener("click", () =>
        modalAddPetProfile.classList.remove("hidden")
      );

      // Cancelar
      btnCancelPetProfile.addEventListener("click", () =>
        modalAddPetProfile.classList.add("hidden")
      );

      // Submiss√£o do form
      formAddPetProfile.addEventListener("submit", async (e) => {
        e.preventDefault();
        const [imagem, descricao, tags, contato] = Array.from(
          formAddPetProfile.querySelectorAll("input")
        ).map((i) => i.value);

        const novoPet = {
          imagem,
          descricao,
          tags: tags.split(",").map((t) => t.trim()),
          contato,
        };

        try {
          const res = await fetch(`${API_URL}/pets`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(novoPet),
          });

          if (!res.ok) throw new Error("Erro ao adicionar pet");

          alert("Pet adicionado com sucesso!");
          modalAddPetProfile.classList.add("hidden");
          formAddPetProfile.reset();
        } catch (err) {
          alert(err.message);
        }
      });
    </script>
  </body>
</html>
